!function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class o{constructor(e,t,s,o,i,r,n,a,l,c,p){this._api=e,this._id=i,this._userId=r,this._image=t,this._title=s,this._alt=o,this._templateSelector=n,this._handleCardClick=a,this._cart=l,this._likes=p,this._deletePopup=c}_getTemplate(){return document.querySelector(this._templateSelector).content.cloneNode(!0)}_insertData(e){const t=e.querySelector(".place__like-counter"),s=e.querySelector(".place__img");s.src=this._image,s.alt=this._alt,t.textContent=this._likes.length;const o=e.querySelector(".place__like");if(this._isLiked()&&o.classList.add("place__like_active"),e.querySelector(".place__name").textContent=this._title,!0===this._cart){e.querySelector(".place__cart").classList.add("place__cart_active")}}_isLiked(){for(let e=0;e<this._likes.length;e++)if(this._likes[e]._id===this._userId)return!0;return!1}_setLikes(e,t){this._isLiked()?this._api.deleteLike(this._id).then(s=>{this._likes=s.likes,e.classList.remove("place__like_active"),t.textContent=s.likes.length}).catch(e=>{console.log(e)}):this._api.likeCard(this._id).then(s=>{this._likes=s.likes,e.classList.add("place__like_active"),t.textContent=s.likes.length}).catch(e=>{console.log(e)})}_addListeners(e){const t=e.querySelector(".place__like"),s=e.querySelector(".place__like-counter");t.addEventListener("click",()=>{this._setLikes(t,s)});e.querySelector(".place__cart").addEventListener("click",e=>{this._deletePopup.openPopup(),this._removeCard(e)});e.querySelector(".place__img").addEventListener("click",()=>{this._handleCardClick(this._image,this._title,this._alt)})}_removeCard(e){this._deletePopup.setOnSubmitHandler(()=>{this._api.deleteCard(this._id).then(()=>{this._deletePopup.closePopup(),e.target.closest(".place").remove()}).catch(e=>{console.log(e)})})}getCard(){const e=this._getTemplate();return this._insertData(e),this._addListeners(e),e}}class i{constructor(e,t){this._settings=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._buttonElement=this._formElement.querySelector(this._settings.submitButtonSelector)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._settings.inputErrorClass),t.textContent=e.validationMessage}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._settings.inputErrorClass),t.textContent=""}_isValid(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_cleanErrors(){this._inputList.forEach(e=>{this._hideInputError(e)})}_hasInvalidInput(){return this._inputList.some(e=>!e.validity.valid)}_setButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._settings.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(){this._setButtonState(),this._inputList.forEach(e=>{e.addEventListener("input",()=>{this._isValid(e),this._setButtonState()})})}enableValidation(){this._setEventListeners(),this._formElement.addEventListener("submit",e=>{e.preventDefault()})}resetValidation(){this._cleanErrors(),this._setButtonState()}}class r{constructor(e,t){this._popup=document.querySelector(e),this._handleEscCloseBinded=this._handleEscClose.bind(this),this._overlayClickCallbackBinded=this._overlayClickCallback.bind(this),this._popupCardCloseButton=this._popup.querySelector(t),this._closeButtonCallback=()=>this.closePopup()}openPopup(){this._popup.classList.add("popup-state_opened"),document.addEventListener("keydown",this._handleEscCloseBinded)}closePopup(){this._popup.classList.remove("popup-state_opened"),document.removeEventListener("keydown",this._handleEscCloseBinded)}_handleEscClose(e){"Escape"===e.key&&this.closePopup()}setEventListeners(){this._popup.addEventListener("click",this._overlayClickCallbackBinded),this._popupCardCloseButton.addEventListener("click",this._closeButtonCallback)}_overlayClickCallback(e){const t=e.target.closest(".popup-state_opened");e.target===t&&this.closePopup()}}class n extends r{constructor(e,t,s,o){super(s,o),this._form=this._popup.querySelector(".popup__form"),this._onSubmitHandler=e,this._closeForm=t}_getInputValues(){const e=this._form.querySelectorAll(".popup__input"),t={};return Array.from(e).forEach(e=>{t[e.name]=e.value}),t}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",e=>{e.preventDefault(),this._onSubmitHandler(this._getInputValues())})}setLoading(){const e=this._form.querySelector(".popup__button");e.disabled=!0,this._buttonNote=e.textContent,e.textContent="Сохранение..."}unsetLoading(){const e=this._form.querySelector(".popup__button");e.disabled=!1,e.textContent=this._buttonNote}closePopup(){super.closePopup(),this._closeForm()}setOnSubmitHandler(e){this._onSubmitHandler=e}}const a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_error"},l=new class{constructor({nameSelector:e,descriptionSelector:t,imageSelector:s}){this._name=document.querySelector(e),this._description=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,description:this._description.textContent,avatar:this._avatar,id:this._id}}setUserInfo(e,t,s,o){this._name.textContent=e,this._description.textContent=t,this._avatar.src=s,this._id=o}}({nameSelector:".profile__info-name",descriptionSelector:".profile__info-description",imageSelector:".profile__avatar"}),c=document.querySelector(".profile__info-edit"),p=document.querySelector(".popup__form"),u=document.querySelector(".popup__input"),d=document.querySelector("#popup__input-description"),_=document.querySelector(".profile__avatar-wrap"),h=document.querySelector("#popup-edit-user .popup__form"),m=new class{constructor(e){this.headers=e.headers,this.url=e.url}getUser(){return fetch(this.url+"/users/me",{headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}getCards(){return fetch(this.url+"/cards",{headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}editUser(e,t){return fetch(this.url+"/users/me",{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}editAvatarUser(e){return fetch(this.url+"/users/me/avatar",{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}createCard(e,t){return fetch(this.url+"/cards",{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}deleteCard(e){return fetch(`${this.url}/cards/${e}`,{method:"DELETE",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}likeCard(e){return fetch(`${this.url}/cards/likes/${e}`,{method:"PUT",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}deleteLike(e){return fetch(`${this.url}/cards/likes/${e}`,{method:"DELETE",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status))}}({url:"https://mesto.nomoreparties.co/v1/cohort-17",headers:{"Content-Type":"application/json",authorization:"9b68a7b1-3b8f-4ce8-9813-2e4457640daa"}}),f=new n((function({link:e}){f.setLoading(),m.editAvatarUser(e).then(e=>{l.setUserInfo(e.name,e.about,e.avatar),f.unsetLoading(),f.closePopup()}).catch(e=>{console.log(e)})}),()=>{},"#popup-edit-user",".popup__close");_.addEventListener("click",()=>{f.setEventListeners(),f.openPopup()});const v=new n(()=>{},()=>{},"#popup-delete",".popup__close");v.setEventListeners();const k=new n((function({name:e,description:t}){k.setLoading(),m.editUser(e,t).then(s=>{l.setUserInfo(e,t,s.avatar),k.closePopup(),k.unsetLoading()}).catch(e=>{console.log(e)})}),()=>{},"#popup-name",".popup__close");k.setEventListeners();new i(a,h).enableValidation();const S=new i(a,p);S.enableValidation(),c.addEventListener("click",(function(){const e=l.getUserInfo();u.value=e.name,d.value=e.description,k.openPopup(),S.resetValidation()}));const y=document.querySelector(".profile__add-button"),g=document.querySelector("#popup-place .popup__form"),E=document.querySelector("#popup__input-title"),b=document.querySelector("#popup__input-link"),C=new i(a,g);C.enableValidation();const L=new n((function(e){L.setLoading(),m.createCard(e.title,e.link).then(e=>{!function(e,t,s,i){const r=l.getUserInfo(),n=new o(m,e,t,s,i,r.id,"#place",q,!0,v,[]);I.addItem(n.getCard(),!1)}(e.link,e.name,e.name,e._id),L.closePopup(),L.unsetLoading()}).catch(e=>{console.log(e)})}),()=>{E.value="",b.value=""},"#popup-place",".popup__close");L.setEventListeners();const P=new class extends r{constructor(e,t){super(e,t),this._popupTitle=this._popup.querySelector(".popup-card__title"),this._popupImg=this._popup.querySelector(".popup-card__img")}openPopup(e,t,s){super.openPopup(),this._popupImg.src=e,this._popupImg.alt=s,this._popupTitle.textContent=t}}("#popup-card",".popup-card__close");P.setEventListeners();const q=(e,t,s)=>{P.openPopup(e,t,s)},I=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}renderItems(e){e.forEach(e=>{this._renderer(e)})}addItem(e,t){t?this._container.append(e):this._container.prepend(e)}}({renderer:e=>{const t=new o(m,e.link,e.name,e.alt,e.id,e.profileId,"#place",q,e.owner===e.profileId,v,e.likes);I.addItem(t.getCard(),!0)}},".places");y.addEventListener("click",(function(){L.openPopup(),C.resetValidation()})),Promise.all([m.getUser(),m.getCards()]).then(e=>{const[t,s]=e;l.setUserInfo(t.name,t.about,t.avatar,t._id);const o=s.map(e=>({link:e.link,name:e.name,alt:e.name,id:e._id,profileId:t._id,likes:e.likes,owner:e.owner._id}));I.renderItems(o)}).catch(e=>{console.log(e)})}]);